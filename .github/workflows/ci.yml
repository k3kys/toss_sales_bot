name: CI Pipeline

# [트리거 조건]
# 1. main 브랜치로 PR이 날아왔을 때 (검증용)
# 2. main 브랜치에 코드가 병합(Push)되었을 때 (최종 확인용)
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-test:
    name: Build Docker Image
    runs-on: ubuntu-latest  # 리눅스 환경에서 실행

    steps:
      # 1. 깃허브에 올라온 코드 내려받기
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. 보안 파일(.env) 더미 생성
      # 실제 비밀키는 깃허브에 없으므로, 빌드 에러 방지용 껍데기 파일을 만듭니다.
      - name: Create dummy .env file
        run: |
          echo "TOSS_SECRET_KEY=dummy" >> .env
          echo "SOLAPI_API_KEY=dummy" >> .env
          echo "SOLAPI_API_SECRET=dummy" >> .env
          echo "SENDER_PHONE=01000000000" >> .env
          echo "MANAGER_PHONE=01000000000" >> .env
          echo "TZ=Asia/Seoul" >> .env

      # 3. 도커 컴포즈 빌드 테스트
      # 여기서 에러가 나면 PR 승인을 막을 수 있습니다.
      - name: Test Docker Build
        run: docker compose build